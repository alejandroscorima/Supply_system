<div class="container" style="margin:20px; max-height:100%;" >
      
  <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="center" color="accent" [(selectedIndex)]="demo1TabIndex">
    
    <mat-tab label="NUEVA ORDEN" class="tabWare" *ngIf="user_role!='SUPERVISOR'">
      <mat-card class="mat-elevation-z8 card-orden">
        <mat-card-title>EMPRESA</mat-card-title>
        <mat-card-content>
          <mat-form-field style="width:22%" class="sala" id="sala" appearance="outline" >
            <mat-label>Tipo:</mat-label>
            <mat-select [(value)]="ord.tipo" >
                <mat-option *ngFor="let t of types" [value]="t">{{t}}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field style="width:22%;" class="sala" id="sala" appearance="outline" >
            <mat-label>Destino:</mat-label>
            <mat-select [(value)]="ord.destino" (selectionChange)="asigChange()">
                <mat-option *ngFor="let c of campus" [value]="c['name']">{{c['name']}}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field style="width:22%;" class="sala" id="sala" appearance="outline" >
            <mat-label>Moneda:</mat-label>
            <mat-select [(value)]="ord.moneda" (selectionChange)="asigMoneyChange()">
                <mat-option *ngFor="let m of monedas" [value]="m">{{m}}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field style="width:22%;" appearance="outline">
            <mat-label>Fecha:</mat-label>
            <input matInput [matDatepicker]="dp3" disabled [(ngModel)]="fecha" #ref (dateChange)="dateChange()">
            <mat-datepicker-toggle matSuffix [for]="dp3"></mat-datepicker-toggle>
            <mat-datepicker #dp3 disabled="false"></mat-datepicker>
          </mat-form-field>

          <mat-form-field style="width:22%;" class="sala" id="sala" appearance="outline" >
            <mat-label>Condiciones Pago:</mat-label>
            <mat-select [(value)]="ord.tipo_pago">
                <mat-option *ngFor="let p of pay_type" [value]="p">{{p}}</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-card-content>
      </mat-card>

      <mat-card class="mat-elevation-z8 card-orden">
        <mat-card-title>PROVEEDOR</mat-card-title>
        <mat-card-content>
          <mat-form-field style="width:32%;" class="doc_id" appearance="outline">
            <mat-label>RUC:</mat-label>
            <input matInput (keyup)="changeRuc()" [(ngModel)]="ord.ruc">
          </mat-form-field>

          <mat-form-field style="width:62%;" class="doc_id" appearance="outline">
            <mat-label>Razon social:</mat-label>
            <input matInput (keyup)="changeRazSoc()" [(ngModel)]="ord.razon_social">
          </mat-form-field>

          <mat-form-field style="width:94%;" class="doc_id" appearance="outline">
            <mat-label>Direccion:</mat-label>
            <input matInput [(ngModel)]="ord.direccion">
          </mat-form-field>

          <mat-form-field style="width:94%;" class="doc_id" appearance="outline">
            <mat-label>Número de Cuenta Bancaria:</mat-label>
            <input matInput [(ngModel)]="ord.num_cuenta">
          </mat-form-field>
        </mat-card-content>
      </mat-card>

      <mat-card class="mat-elevation-z8 card-orden">
        <mat-card-title>Nuevo item</mat-card-title>
        <mat-card-content>
          <mat-form-field style="width:10%;" class="doc_id" appearance="outline">
            <mat-label>Cantidad:</mat-label>
            <input type="number" matInput [(ngModel)]="orden_item.cantidad">
          </mat-form-field>

          <mat-form-field style="width:50%;" appearance="outline">
            <mat-label>Descripcion:</mat-label>
            <input matInput [(ngModel)]="orden_item.descripcion">
          </mat-form-field>

          <mat-form-field style="width:15%;" appearance="outline">
            <mat-label>Precio Unit:</mat-label>
            <input matInput [(ngModel)]="orden_item.unit_price">
            <span matPrefix>{{prefijoMoney}}&nbsp;</span>
          </mat-form-field>


        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-raised-button style="background-color: #b03a64; color:white" (click)="addItem()">
            <mat-icon>add</mat-icon>AGREGAR ITEM
          </button>
        </mat-card-actions>
      </mat-card>

      <mat-card class="mat-elevation-z8 card-orden">
        <mat-card-title>Lista</mat-card-title>
        <mat-card-content>
<!--               <mat-form-field appearance="standard" style="display:display-inline">
            <mat-label>Búsqueda</mat-label>
            <input matInput (keyup)="applyFilterD($event)" placeholder="Escribe algo para buscar" #input1>
          </mat-form-field> -->


          <div class="mat-elevation-z8" style="width:100%;">
              <table mat-table style="width:100%;" [dataSource]="dataSourceOrd" matSort>

                <ng-container matColumnDef="cantidad">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> CANTIDAD </th>
                  <td mat-cell *matCellDef="let a"> {{a.cantidad}}</td>
                </ng-container>

                <ng-container matColumnDef="descripcion">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> DESCRIPCION </th>
                  <td mat-cell *matCellDef="let a"> {{a.descripcion}}</td>
                </ng-container>

                <ng-container matColumnDef="unit_price">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> PRECIO UNIT </th>
                  <td mat-cell *matCellDef="let a"> {{a.unit_price}}</td>
                </ng-container>

                <ng-container matColumnDef="subtotal">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> SUBTOTAL </th>
                  <td mat-cell *matCellDef="let a"> {{a.subtotal}}</td>
                </ng-container>

                <ng-container matColumnDef="igv_toggle">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> IGV </th>
                  <td mat-cell *matCellDef="let a">
                    <mat-slide-toggle [checked]="a.igv_toggle" (change)="changeIgvToggleUnit(a)">
                    </mat-slide-toggle>
                    {{a.igv_unit}}
                  </td>
                </ng-container>


                <ng-container matColumnDef="edit">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> </th>
                  <td mat-cell *matCellDef="let a; let i=index">
                    <button class="btnEdit" mat-icon-button focusable="false"  (click)="editItem(a,i)">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button class="btnDel" mat-icon-button focusable="false"  (click)="deleteItem(i)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <ng-container matColumnDef="empty2">
                  <td mat-footer-cell *matFooterCellDef colspan="2">
                  </td>
                </ng-container>

                <ng-container matColumnDef="empty1">
                  <td mat-footer-cell *matFooterCellDef colspan="1">
                  </td>
                </ng-container>

                <ng-container matColumnDef="subtotalO_label">
                  <td mat-footer-cell *matFooterCellDef colspan="1">
                    SUBTOTAL
                  </td>
                </ng-container>

                <ng-container matColumnDef="igv_label">
                  <td mat-footer-cell *matFooterCellDef colspan="1">
                    <mat-checkbox [(ngModel)]="igvActivated" [disabled]="listaOrd.length==0"
                      (ngModelChange)="updateIgv()">
                    </mat-checkbox>
                    IGV
                    <mat-form-field style="width: 100px; border-top:-15px; margin-bottom: -1.25em;" appearance="outline">
                      <input (keyup)="changeIgv()" [disabled]="!igvActivated||(listaOrd.length==0)" matInput [(ngModel)]="ord.igv_percent">
                    </mat-form-field>
                    %
                  </td>
                </ng-container>

                <ng-container matColumnDef="retencion_label">
                  <td stye='text-align:right; align-content:right;' mat-footer-cell *matFooterCellDef colspan="1">
                    <mat-checkbox [(ngModel)]="retencionActivated" [disabled]="listaOrd.length==0"
                      (ngModelChange)="updateRetencion()">
                    </mat-checkbox>
                    Retención
                    <mat-form-field style="width: 100px; border-top:-15px; margin-bottom: -1.25em;" appearance="outline">
                      <input (keyup)="changeRet()" [disabled]="!retencionActivated" matInput [(ngModel)]="ord.retencion_percent">
                    </mat-form-field>
                    %
                  </td>
                </ng-container>

                <ng-container matColumnDef="percepcion_label">
                  <td stye='text-align:right; align-content:right;' mat-footer-cell *matFooterCellDef colspan="1">
                    <mat-checkbox [(ngModel)]="percepcionActivated" [disabled]="listaOrd.length==0"
                      (ngModelChange)="updatePercepcion()">
                    </mat-checkbox>
                    Percepción
                    <mat-form-field style="width: 100px; border-top:-15px; margin-bottom: -1.25em;" appearance="outline">
                      <input (keyup)="changePercep()" [disabled]="!percepcionActivated" matInput [(ngModel)]="percepInput">
                    </mat-form-field>
                  </td>
                </ng-container>

                <ng-container matColumnDef="igv_included">
                  <td mat-footer-cell *matFooterCellDef colspan="2">
                    <mat-slide-toggle [checked]="igvSlideChecked" [disabled]="igvSlideDisabled||listaOrd.length==0" (change)="change($event)">
                      IGV incluido
                    </mat-slide-toggle>
                  </td>
                </ng-container>

                <ng-container matColumnDef="total_label">
                  <td mat-footer-cell *matFooterCellDef colspan="1">
                    TOTAL
                  </td>
                </ng-container>

                <ng-container matColumnDef="subtotalO">
                  <td mat-footer-cell *matFooterCellDef colspan="1">
                    {{ord.subtotal}}
                  </td>
                </ng-container>

                <ng-container matColumnDef="retencion">
                  <td mat-footer-cell *matFooterCellDef colspan="1">
                    {{ord.retencion}}
                  </td>
                </ng-container>

                <ng-container matColumnDef="percepcion">
                  <td mat-footer-cell *matFooterCellDef colspan="1">
                    {{ord.percepcion}}
                  </td>
                </ng-container>

                <ng-container matColumnDef="igv">
                  <td mat-footer-cell *matFooterCellDef colspan="1">
                    {{ord.igv}}
                  </td>
                </ng-container>

                <ng-container matColumnDef="total">
                  <td mat-footer-cell *matFooterCellDef colspan="1">
                    {{ord.total}}
                  </td>
                </ng-container>


                <tr mat-header-row *matHeaderRowDef="['cantidad','descripcion','unit_price','subtotal','igv_toggle','edit'];"></tr>
                <tr mat-row *matRowDef="let row; columns: ['cantidad','descripcion','unit_price','subtotal','igv_toggle','edit'];"></tr>

                <tr mat-footer-row *matFooterRowDef="['empty2','subtotalO_label','subtotalO','empty2']" style="font-weight: bold;" ></tr>
                <tr mat-footer-row *matFooterRowDef="['empty2','igv_label','igv','empty2']" style="font-weight: bold;" ></tr>
                <tr mat-footer-row *matFooterRowDef="['empty2','igv_included','empty2']" style="font-weight: bold;" ></tr>
                <tr mat-footer-row *matFooterRowDef="['empty2','retencion_label','retencion','empty2']" style="font-weight: bold;" ></tr>
                <tr mat-footer-row *matFooterRowDef="['empty2','percepcion_label','percepcion','empty2']" style="font-weight: bold;" ></tr>
                <tr mat-footer-row *matFooterRowDef="['empty2','total_label','total','empty2']" style="font-weight: bold;" ></tr>



                <tr class="mat-row" *matNoDataRow>
                  <td class="mat-cell" colspan="6">No se encontró "{{input1.value}}"</td>
                </tr>
              </table>

              <!-- <mat-paginator [pageSizeOptions]="[10, 20, 50, 100]" aria-label="Página"></mat-paginator> -->
          </div>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-button style="width:76%; height:50px; padding: 0px ;margin:5px; text-align: right; padding-right: 10px;">
            MONTO INICIAL:{{' '+prefijoMoney}}
          </button>
          <mat-form-field style="width:13%; height:50px; border-top:-15px; margin-bottom: -1.25em;" appearance="outline">
            <input matInput [(ngModel)]="ord.rebajado">
          </mat-form-field>
          <button mat-raised-button style="background-color:rgb(32, 142, 32); color: white; height:60px; width:25%" (click)="generarOrden()" >
            <mat-icon>check</mat-icon>Generar Orden
          </button>
        </mat-card-actions>
      </mat-card>
    </mat-tab>
    
    <mat-tab label="VER ORDENES" class="tabWare">

      <mat-form-field style="width:40%;" appearance="outline" *ngIf="user_role=='SUPER ADMINISTRADOR' || user_role=='SUPERVISOR'">
        <mat-label>Destino:</mat-label>
        <mat-select [(ngModel)]="campusToView" [compareWith]="compareObjectsView" (selectionChange)="changeDestinoView()">
            <mat-option *ngFor="let cv of campusView" [value]="cv">{{cv.name}}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="standard" style="display:display-inline">
          <mat-label>Búsqueda</mat-label>
          <input matInput (keyup)="applyFilterDView($event)" placeholder="Escribe algo para buscar" #input1>
      </mat-form-field>

      <div class="mat-elevation-z8" style="width:100%;">
          <table mat-table style="width:100%;" [dataSource]="dataSourceOrdersView" matSort multiTemplateDataRows>

            <ng-container matColumnDef="fecha">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> FECHA </th>
              <td mat-cell *matCellDef="let a"> {{a.fecha}}</td>
            </ng-container>

            <ng-container matColumnDef="numero">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> NUMERO </th>
              <td mat-cell *matCellDef="let a"> {{a.numero}}</td>
            </ng-container>

            <ng-container matColumnDef="empresa">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> RAZON SOCIAL </th>
              <td mat-cell *matCellDef="let a"> {{a.empresa}}</td>
            </ng-container>

            <ng-container matColumnDef="destino">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> DESTINO </th>
              <td mat-cell *matCellDef="let a"> {{a.destino}}</td>
            </ng-container>

            <ng-container matColumnDef="ruc">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> PROVEEDOR </th>
              <td mat-cell *matCellDef="let a"> {{a.ruc}}</td>
            </ng-container>

            <ng-container matColumnDef="total">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> TOTAL </th>
              <td mat-cell *matCellDef="let a"> {{a.total}}</td>
            </ng-container>

            <ng-container matColumnDef="rebajado">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> MONTO INICIAL </th>
              <td mat-cell *matCellDef="let a"> {{a.rebajado}}</td>
            </ng-container>

            <ng-container matColumnDef="pdf">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> PDF </th>
              <td mat-cell *matCellDef="let a">
                <button mat-button color="accent" (click)="reCreatePDFView(a)">
                  <mat-icon>description</mat-icon>
                </button>
              </td>
            </ng-container>

            <ng-container matColumnDef="edit">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> ANULAR </th>
              <td mat-cell *matCellDef="let a; let i=index">
                <button *ngIf="a.estado!='ANULADO'" mat-icon-button color="primary" (click)="anularView(a)"> <mat-icon> cancel </mat-icon> </button>&nbsp;
              </td>
            </ng-container>

            <ng-container matColumnDef="receipt">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> COMPROBANTE </th>
              <td mat-cell *matCellDef="let a; let i=index">
                <button *ngIf="a.receipt=='NO'" mat-icon-button (click)="addReceiptView(a)">  <mat-icon> receipt_long </mat-icon></button>
                <button *ngIf="a.receipt=='SI'" mat-icon-button (click)="editReceiptView(a)">  <mat-icon> edit </mat-icon></button>
              </td>
            </ng-container>

            <ng-container matColumnDef="comprobante">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> NUMERO </th>
              <td mat-cell *matCellDef="let a"> {{a.comprobante}}</td>
            </ng-container>

            <ng-container matColumnDef="txt">
              <th mat-header-cell *matHeaderCellDef > TXT 
                <button mat-icon-button color="primary" (click)="createTxtFile()"> <mat-icon> save_alt </mat-icon> </button>
              </th>
              <td mat-cell *matCellDef="let a; let i=index">
                <mat-checkbox class="example-margin" (change)="listTxtChange($event,a)"
                [checked]="selectionTxt.isSelected(a)" [disabled]="a.txt=='SI'"></mat-checkbox>&nbsp;
              </td>
            </ng-container>

            <ng-container matColumnDef="docs">
              <th mat-header-cell *matHeaderCellDef > DOCS </th>
              <td mat-cell *matCellDef="let a; let i=index">
                <button mat-button (click)="showDocs(a)">
                  <mat-icon>folder</mat-icon>
                </button>
              </td>
            </ng-container>
            

            <tr mat-header-row *matHeaderRowDef="['fecha','numero','empresa','destino','ruc','total','rebajado','pdf','edit','receipt','comprobante','txt','docs']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['fecha','numero','empresa','destino','ruc','total','rebajado','pdf','edit','receipt','comprobante','txt','docs'];"></tr>



            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" colspan="6">No se encontró "{{input1.value}}"</td>
            </tr>
          </table>

          <mat-paginator [pageSizeOptions]="[10, 20, 50, 100]" aria-label="Página"></mat-paginator>
      </div>
    </mat-tab>
  
  </mat-tab-group>

</div>


